事务管理器如果不是全局配置的话，那有哪些是全局配置？全局配置应该放在哪一层？

| 认为事务管理器配置属于“全局配置” | 事务管理器是基础设施的一部分，应与数据库连接池、ORM 框架等配置统一管理 |

--- R1

### 全局配置与基础设施配置的区分及分层策略

---

#### **1. 全局配置的定义与示例**

全局配置指**影响整个应用程序行为**的设定，通常不直接关联具体业务逻辑或技术实现细节，而是定义应用的运行环境、基础规则或通用开关。常见类型包括：

| **全局配置类型**       | **示例**                                       |
| ---------------------- | ---------------------------------------------- |
| **应用元信息**         | 应用名称、版本号、启动端口、上下文路径         |
| **全局开关与特性标志** | 功能开关（Feature Flags）、调试模式、维护模式  |
| **日志与监控配置**     | 日志级别、监控采样率、跟踪 ID 生成规则         |
| **安全策略**           | 跨域配置（CORS）、全局权限规则、密码复杂度要求 |
| **国际化与本地化**     | 默认语言、时区、日期格式                       |

---

#### **2. 全局配置的归属层级**

在 DDD 架构中，全局配置应属于**应用层（Application Layer）**，原因如下：

1. **影响范围**：全局配置作用于整个应用，与应用层协调多领域协作的职责一致。
2. **业务无关性**：不涉及具体领域逻辑，仅定义应用运行规则。
3. **技术中立性**：部分全局配置（如特性开关）可能与业务策略相关，但无需依赖技术实现。

**代码位置示例**：

```text
src/
├── main/
│   ├── java/
│   │   └── com/
│   │       └── example/
│   │           ├── application/          # 应用层
│   │           │   └── config/           # 全局配置目录
│   │           │       ├── AppProperties.java
│   │           │       └── FeatureFlagsConfig.java
│   │           ├── domain/               # 领域层
│   │           ├── interfaces/           # 用户接口层
│   │           └── infrastructure/      # 基础设施层
│   │               └── config/            # 技术组件配置
│   │                   ├── DatabaseConfig.java
│   │                   └── CacheConfig.java
```

---

#### **3. 基础设施配置的归属层级**

基础设施配置是**技术组件实现的具体参数**，属于**基础设施层（Infrastructure Layer）**，例如：

| **基础设施配置类型** | **示例**                                                                |
| -------------------- | ----------------------------------------------------------------------- |
| **数据库连接**       | 数据源 URL、连接池大小、事务管理器（如 `DataSourceTransactionManager`） |
| **缓存配置**         | Redis 地址、缓存过期时间、序列化方式                                    |
| **消息队列集成**     | Kafka Broker 地址、Topic 名称、消费者组配置                             |
| **外部服务集成**     | HTTP 客户端超时设置、重试策略、API 密钥                                 |
| **邮件与通知服务**   | SMTP 服务器、发件人邮箱、模板路径                                       |

**代码位置示例**：

```java
// 基础设施层配置类
package com.example.infrastructure.config;

@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        // 配置数据源
        return new HikariDataSource(...);
    }

    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        // 事务管理器配置（基础设施层）
        return new DataSourceTransactionManager(dataSource);
    }
}
```

---

#### **4. 关键区别与协作**

| **维度**     | **全局配置**                   | **基础设施配置**                       |
| ------------ | ------------------------------ | -------------------------------------- |
| **核心目标** | 定义应用运行环境与通用规则     | 实现技术组件的具体集成与参数设定       |
| **所属层级** | 应用层                         | 基础设施层                             |
| **变更频率** | 较低（如版本号、端口）         | 较高（如数据库连接池、缓存策略）       |
| **依赖关系** | 可能被所有层引用（如特性开关） | 仅被基础设施层组件依赖                 |
| **配置方式** | 注解、YAML/Properties 文件     | Java Config 类、外部化配置（如 Vault） |

---

#### **5. 实践建议**

1. **全局配置集中管理**：  
   使用 `@ConfigurationProperties` 或 Spring Boot 的 `application.yml` 统一管理全局参数，避免分散。

   ```yaml
   # application.yml
   app:
     name: Sprinkler Management
     version: 1.0.0
     security:
       cors-allowed-origins: "https://example.com"
   ```

2. **基础设施配置模块化**：  
   按技术领域拆分配置类（如 `DatabaseConfig`、`CacheConfig`），提升可维护性。

3. **避免技术细节渗透到应用层**：  
   应用层通过接口调用基础设施能力，而非直接依赖其配置类。

---

### **总结**

- **全局配置**：定义应用级规则与环境参数 → **应用层**。
- **基础设施配置**：实现技术组件集成 → **基础设施层**。
- **事务管理器**：作为数据库访问的技术实现 → **基础设施层**。

通过明确分层，可构建高内聚、低耦合的 DDD 架构，提升系统的可维护性与扩展性。
